sudo apt update && sudo apt upgrade -y
sudo apt install -y wireguard

Generar claves y archivo de configuración
sudo mkdir -p /etc/wireguard
cd /etc/wireguard
sudo umask 077

# Generar las claves
sudo wg genkey | tee server_private.key | wg pubkey > server_public.key
sudo wg genkey | tee peer1_private.key | wg pubkey > peer1_public.key


Crea el archivo de configuración /etc/wireguard/wg0.conf:

sudo nano /etc/wireguard/wg0.conf

Y pega lo siguiente (ajustando IPs y claves):

[Interface]
Address = 10.10.0.1/24
ListenPort = 51820
PrivateKey = <CLAVE_PRIVADA_DEL_SERVIDOR>
MTU = 1380
PostUp = iptables -t nat -A POSTROUTING -s 10.10.0.0/24 -o ens5 -j MASQUERADE; iptables -A FORWARD -i wg0 -o ens5 -j ACCEPT; iptables -A FORWARD -i ens5 -o wg0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
PostDown = iptables -t nat -D POSTROUTING -s 10.10.0.0/24 -o ens5 -j MASQUERADE; iptables -D FORWARD -i wg0 -o ens5 -j ACCEPT; iptables -D FORWARD -i ens5 -o wg0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT


[Peer]
PublicKey = <peer1_public.key>
AllowedIPs = 10.10.0.2/32

# Detener la interfaz actual
sudo wg-quick down wg0

# Iniciar la interfaz con la configuración corregida
sudo wg-quick up wg0

PASO 4: Activar el reenvío de IP

Ejecuta:

sudo sysctl -w net.ipv4.ip_forward=1

Hazlo permanente editando:

sudo nano /etc/sysctl.conf


y asegúrate de tener:

net.ipv4.ip_forward=1


Aplica cambios:

sudo sysctl -p

Genera el archivo del cliente 

Crea:

sudo nano /etc/wireguard/client.conf


Pega:

[Interface]
PrivateKey = <client_private.key>
Address = 10.10.0.2/32
DNS = 1.1.1.1

[Peer]
PublicKey = <server_public.key>
Endpoint = <TU_IP_PUBLICA>:51820
AllowedIPs = 0.0.0.0/0
PersistentKeepalive = 25


Guarda y luego genera el QR:

sudo apt install -y qrencode
sudo qrencode -t ansiutf8 < /etc/wireguard/client.conf


ubuntu@ip-172-31-26-133:~$ sudo cat /etc/wireguard/peer1_private.key
2NC7dXfCxE/Zq9xPlbHuYIKk3pZUf5irNGOEpHT81E4=
ubuntu@ip-172-31-26-133:~$ sudo cat /etc/wireguard/server_public.key
3DalbksZvkTVL5bsFwgBoQnxJggwJ6oeJWxm6PTFHWQ=

para el apagado y reinicio


ip route (buscar dev en la línea default)

sudo wg show
ip route show


cat /etc/wireguard/wg0.conf (buscar Address)

cat /proc/sys/net/ipv4/ip_forward

sudo nano /etc/sysctl.conf

sudo sysctl -p

sudo nano /etc/wireguard/wg0.conf

[Interface]
Address = 10.10.0.1/24
ListenPort = 51820
PrivateKey = mDr6TpGOdcCLyXTXpI+PAlC+e+/UPMM/N7e+7msP2G8=
MTU = 1380

PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT; iptables -t nat -A POSTROUTING -s 10.10.0.0/24 -o enp39s0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -D FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT; iptables -t nat -D POSTROUTING -s 10.10.0.0/24 -o enp39s0 -j MASQUERADE

[Peer]
PublicKey = +kkIcGSi+oPbUYLr4MQ/btgfjHU+H/Sy5EW0CQR/HyI=
AllowedIPs = 10.10.0.2/32

sudo wg-quick down wg0
sudo wg-quick up wg0

sudo systemctl enable wg-quick@wg0

[Interface]
Address = 10.10.0.1/24
ListenPort = 51820
PrivateKey = mDr6TpGOdcCLyXTXpI+PAlC+e+/UPMM/N7e+7msP2G8=
MTU = 1380

PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT; iptables -t nat -A POSTROUTING -s 10.10.0.0/24 -o enp39s0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -D FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT; iptables -t nat -D POSTROUTING -s 10.10.0.0/24 -o enp39s0 -j MASQUERADE


[Peer]
PublicKey = +kkIcGSi+oPbUYLr4MQ/btgfjHU+H/Sy5EW0CQR/HyI=
AllowedIPs = 10.10.0.2/32
